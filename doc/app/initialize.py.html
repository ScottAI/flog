<!DOCTYPE html>
<html>
<head>
  <title>initialize.py</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "app/initialize.py", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>initialize.py</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">flask.ext.appbuilder.security.models</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Role</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">appbuilder</span>
<span class="kn">from</span> <span class="nn">app.models</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">default_blog_config</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">admin_role</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Role</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">auth_role_admin</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="n">admin</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>\
                     <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="n">admin_role</span><span class="p">)</span>\
                     <span class="o">.</span><span class="n">first</span><span class="p">()</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>We will always have a config named default,
to make sure we don't break anything important</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="n">default_config</span> <span class="o">=</span> <span class="n">BlogConfig</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;default&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s">&quot;A good default configuration&quot;</span><span class="p">,</span>
            <span class="n">blog_title</span><span class="o">=</span><span class="s">&quot;Blog Title&quot;</span><span class="p">,</span>
            <span class="n">blog_subtitle</span><span class="o">=</span><span class="s">&quot;A blog subtitle&quot;</span><span class="p">,</span>
            <span class="n">window_title</span><span class="o">=</span><span class="s">&quot;A blog&quot;</span><span class="p">,</span>
            <span class="n">edit_lag_in_minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">entries_in_sidebar</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">entries_per_page</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">show_all_tab</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">created_by</span><span class="o">=</span><span class="n">admin</span><span class="p">,</span>
            <span class="n">changed_by</span><span class="o">=</span><span class="n">admin</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">default_config</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">choose_config</span> <span class="o">=</span> <span class="n">ChooseConfig</span><span class="p">(</span><span class="n">chosen_config_id</span><span class="o">=</span><span class="n">default_config</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">created_by</span><span class="o">=</span><span class="n">admin</span><span class="p">,</span> <span class="n">changed_by</span><span class="o">=</span><span class="n">admin</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">choose_config</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">default_categories</span><span class="p">():</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>A default category to avoid having zero categories</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">default_category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;default&quot;</span><span class="p">,</span>
            <span class="n">slug</span><span class="o">=</span><span class="s">&quot;default&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s">&quot;A default category (don&#39;t add entries here)&quot;</span><span class="p">,</span>
            <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">default_category</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Category</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">main_category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;Main&quot;</span><span class="p">,</span>
            <span class="n">slug</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s">&quot;Main category for the Blog&quot;</span><span class="p">,</span>
            <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">about_category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;About&quot;</span><span class="p">,</span>
            <span class="n">slug</span><span class="o">=</span><span class="s">&quot;about&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s">&quot;&#39;About&#39; category for the blog&quot;</span><span class="p">,</span>
            <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">contact_category</span> <span class="o">=</span> <span class="n">Category</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s">&quot;Contact&quot;</span><span class="p">,</span>
            <span class="n">slug</span><span class="o">=</span><span class="s">&quot;contact&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s">&quot;&#39;Contact&#39; category for the blog&quot;</span><span class="p">,</span>
            <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">index</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add_all</span><span class="p">([</span><span class="n">main_category</span><span class="p">,</span>
                            <span class="n">about_category</span><span class="p">,</span>
                            <span class="n">contact_category</span><span class="p">])</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">initialize</span><span class="p">():</span>
    <span class="n">default_blog_config</span><span class="p">()</span>
    <span class="n">default_categories</span><span class="p">()</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
